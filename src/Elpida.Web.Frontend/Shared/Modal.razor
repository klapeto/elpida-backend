@using System.Threading
<CascadingValue Value="this">
    @ChildContent
    <div class="modal-bg @ShowClass">
        <div class="groupBox modal-container @GetContainerAdditionalClasses()">
            <h3 class="modal-header">
                @_title 
                <button class="button small close" @onclick="OnCloseClicked" style="margin: 0.4em;">ðŸ—™</button>
            </h3>
            <div class="groupBoxContent modal-content">
                @_body
            </div>
        </div>
    </div>
</CascadingValue>

@code {

    [Parameter]
    public RenderFragment ChildContent { get; set; }

    private string? ShowClass => !_show ? "hidden" : null;

    private bool _show;
    private string _title = "";
    private RenderFragment _body = @<p>No content</p>;

    private readonly RenderFragment<Exception> _errorFragment = ex => @<div class="exception-container">
                                                                          <b>Type:</b><code class="exception-detail">@ex.GetType().Name</code>
                                                                          <b>Message:</b><code class="exception-detail">@ex.Message</code>
                                                                          <b>Stack trace:</b><code class="exception-detail">@ex.StackTrace</code>
                                                                      </div>;

    private bool _autoSize;

    public void ShowError(Exception ex)
    {
        _title = "Error";
        _show = true;
        _body = _errorFragment(ex);
        StateHasChanged();
    }

    private string? GetContainerAdditionalClasses()
    {
        return _autoSize ? "auto-size" : null;
    }

    private void OnCloseClicked()
    {
        _show = false;
    }

    public Action ShowContent(string title, RenderFragment body, bool autoSize)
    {
        _title = title;
        _body = body;
        _show = true;
        _autoSize = autoSize;
        StateHasChanged();
        return () =>
        {
            OnCloseClicked();
            StateHasChanged();
        };
    }

    public void ShowMessage(string title, string message)
    {
        _ = ShowContent(title, @<p>@message</p>, true);
    }
    
}